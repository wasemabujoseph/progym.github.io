<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø°ÙƒÙŠ | Smart Trainer Pro â€” ØªØ·Ø¨ÙŠÙ‚ ØªØ¯Ø±ÙŠØ¨ÙŠ Ø§Ø­ØªØ±Ø§ÙÙŠ ÙŠØ¹Ù…Ù„ Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„ Ù…Ø¹ Ù…ÙƒØªØ¨Ø© ØªÙ…Ø§Ø±ÙŠÙ† ÙƒØ§Ù…Ù„Ø© ÙˆØªÙˆÙ„ÙŠØ¯ Ø®Ø·Ø· Ø¹Ø¨Ø± Gemini." />
  <meta name="referrer" content="no-referrer" />
  <title>ğŸ’ª Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø°ÙƒÙŠ | Smart Trainer Pro</title>

  <!-- Favicon -->
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="0.9em" font-size="90">ğŸ’ª</text></svg>' />

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" integrity="sha512-1PKOgIY59xJ6+GY2a9Y+Y1FQK6W1n1Dp1V1LhWlQ8GvZ6xjlbUY8ailqDun3vsl0sbG3fjHb4GJ8V+CsVxC1BA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    :root{
      /* tweaked palette to match Amani blue */
      --bg1:#14213d; --bg2:#1d3557; --glass:rgba(255,255,255,.08); --border:rgba(255,255,255,.18);
      --text:#f1f5f9; --muted:#cbd5e1; --accent:#2d8cff; --accent2:#6ad2ff;
      --card:rgba(255,255,255,.07); --shadow:0 10px 30px rgba(0,0,0,.25);
      --chip:#2d8cff; --chip2:#10b981; --chip3:#f59e0b;
    }
    [data-theme="light"]{
      --bg1:#eef2ff; --bg2:#e2e8f0; --glass:rgba(255,255,255,.7); --border:rgba(0,0,0,.08);
      --text:#0f172a; --muted:#334155; --accent:#2563eb; --accent2:#7c3aed;
      --card:rgba(255,255,255,.9); --shadow:0 6px 18px rgba(0,0,0,.12);
      --chip:#2563eb; --chip2:#16a34a; --chip3:#d97706;
    }
    html,body{height:100%}
    body{
      margin:0; font-family:'Cairo',system-ui,-apple-system,Segoe UI,Roboto; color:var(--text);
      background:linear-gradient(135deg,var(--bg1),var(--bg2)); background-attachment:fixed;
    }
    .en{font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto}
    .container{max-width:1200px;margin:auto;padding:20px}
    header{
      display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      padding:16px 20px; border-radius:18px; background:var(--glass); border:1px solid var(--border); box-shadow:var(--shadow);
      position:sticky; top:12px; z-index:10; backdrop-filter:blur(12px);
    }
    .brand{display:flex; align-items:center; gap:12px; font-weight:700; font-size:1.2rem}
header{backdrop-filter:saturate(1.2) blur(8px); background:linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.25)); border-bottom:1px solid var(--border)}
body.dark header{background:linear-gradient(180deg, rgba(10,12,16,.55), rgba(10,12,16,.25))}
.persona-pro{display:flex; align-items:center; gap:10px; padding:6px 12px; border-radius:999px; background:linear-gradient(135deg,var(--chip),var(--chip2)); color:#00111a; border:1px solid var(--border); box-shadow:0 1px 2px rgba(0,0,0,.08); filter:saturate(.95)}
.persona-pro .avatar{width:22px; height:22px; border-radius:999px; display:grid; place-items:center; font-weight:800; font-size:.8rem; background:#ffffff80; border:1px solid #00000020}
.persona-pro .p-text{font-weight:700; font-size:.9rem}
.btn{border-radius:12px; padding:10px 14px; border:1px solid var(--border); box-shadow:0 1px 2px rgba(0,0,0,.05); transition:.2s transform, .2s box-shadow}
.btn:hover{transform:translateY(-1px); box-shadow:0 4px 12px rgba(0,0,0,.10)}
.card{border-radius:16px; box-shadow:0 2px 14px rgba(0,0,0,.08); border:1px solid var(--border); overflow:hidden; transition:.2s transform, .2s box-shadow}
.card:hover{transform:translateY(-2px); box-shadow:0 10px 24px rgba(0,0,0,.12)}
.media{position:relative; background:#000; aspect-ratio:16/9}
.media .provider{position:absolute; top:10px; left:10px; padding:4px 8px; border-radius:999px; background:rgba(0,0,0,.55); color:#fff; font-size:.72rem}

.persona{font-size:.88rem; font-weight:700; padding:4px 10px; border-radius:999px; background:linear-gradient(135deg,var(--chip),var(--chip2)); color:#00111a; border:1px solid var(--border);}
    .brand .logo{
      width:36px;height:36px;display:grid;place-items:center;background:var(--card);border-radius:12px;
      box-shadow:0 6px 20px rgba(45,140,255,.35) inset;
    }
    .brand .logo svg{width:22px;height:22px;display:block;color:var(--accent)}
    .controls{display:flex; gap:8px; flex-wrap:wrap}
    .btn{
      display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px;
      background:var(--card); border:1px solid var(--border); cursor:pointer; box-shadow:var(--shadow);
      transition:.2s transform,.2s opacity,.2s background; text-decoration:none; color:inherit; font-weight:600;
    }
    .btn:hover{transform:translateY(-2px)}
    .btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#00111a}
    .tabs{display:flex; gap:10px; margin:18px 0 10px}
    .tab{padding:10px 14px; border-radius:12px; background:var(--card); border:1px solid var(--border); cursor:pointer; font-weight:700}
    .tab.active{outline:2px solid var(--accent)}
    .panel{display:none}
    .panel.active{display:block}
    .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:14px}
    .card{background:var(--glass); border:1px solid var(--border); border-radius:18px; overflow:hidden; box-shadow:var(--shadow); display:flex; flex-direction:column}
    .media{position:relative; background:rgba(0,0,0,.15); aspect-ratio:4/3; display:block; overflow:hidden}
    .media .provider{position:absolute;left:8px;top:8px;background:rgba(0,0,0,.6);color:#fff;font-size:.72rem;padding:2px 6px;border-radius:8px}
    .media button.edit{position:absolute;right:8px;top:8px;background:rgba(255,255,255,.9);border:0;border-radius:999px;padding:6px;cursor:pointer}
    .media button.edit:hover{background:#ffd166}
    .media .overlay{
      position:absolute; left:8px; bottom:8px;
      display:flex; flex-direction:column; gap:4px;
      background:linear-gradient(135deg, rgba(0,0,0,.65), rgba(0,0,0,.35));
      border:1px solid var(--border);
      border-radius:10px; padding:6px 8px;
      backdrop-filter: blur(6px);
      color:#fff; max-width:90%;
      box-shadow: var(--shadow);
    }
    .media .overlay .name{ font-weight:800; font-size:.95rem; line-height:1.2 }
    .media .overlay .muscle{ font-size:.8rem; opacity:.9 }
    .media img,.media video,.media iframe{width:100%;height:100%;object-fit:cover;display:block;border:0; border-radius:0}
    .content{padding:12px 14px; display:flex; flex-direction:column; gap:8px}
    .title{display:flex; align-items:center; justify-content:space-between; gap:8px}
    .badges{display:flex; gap:6px; flex-wrap:wrap}
    .badge{font-size:.72rem; padding:4px 8px; border-radius:999px; background:var(--card); border:1px solid var(--border)}
    .badge.best{background:linear-gradient(135deg,var(--chip),var(--chip2)); color:#00111a}
    .badge.home{background:linear-gradient(135deg,var(--chip2),var(--chip3)); color:#00111a}
    .meta{font-size:.9rem; color:var(--muted)}
    .actions{display:flex; gap:8px; flex-wrap:wrap}
    .actions .btn{padding:8px 10px; font-size:.9rem}
    .searchbar{display:flex; gap:8px; margin:10px 0}
    .searchbar input{flex:1;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:var(--card);color:inherit}
    .chips{display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 14px}
    .chip{padding:8px 12px; border-radius:999px; background:var(--card); border:1px solid var(--border); cursor:pointer}
    .chip.active{outline:2px solid var(--accent)}
    .fieldset{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px; margin:12px 0}
    .field{display:flex; flex-direction:column; gap:6px}
    .field input,.field select, textarea{
      padding:12px 14px; border-radius:12px; border:1px solid var(--border); background:var(--card); color:inherit;
    }
    .plan{white-space:pre-wrap; background:var(--glass); border:1px solid var(--border); border-radius:16px; padding:14px; line-height:1.8}
    footer{opacity:.8; font-size:.9rem; margin:16px 0; text-align:center}
    @keyframes fadeIn{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none}}
    .fadeIn{animation:fadeIn .35s ease both}
    @media print{
      header,.tabs,.chips,.searchbar,.actions-toolbar,.controls,.api-key{display:none!important}
      body{background:#fff}
      .card{break-inside:avoid}
    }
  </style>
</head>
<body data-persona='Amani'>
  <div class="container">
    <header class="fadeIn">
      <div class="brand">
        <!-- Amani kettlebell-A logo (inline SVG) -->
        <div class="logo" aria-label="Amani logo">
          <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" fill="currentColor" role="img" aria-hidden="true">
            <path d="M35 20 h50 a15 15 0 0 1 15 15 v6 a15 15 0 0 1 -15 15 h-50 a15 15 0 0 1 -15 -15 v-6 a15 15 0 0 1 15 -15 z"/>
            <path d="M20 95 L44 50 H76 L100 95 Q101 100 95 100 H79 Q76 100 75 98 L66 82 H54 L45 98 Q44 100 41 100 H25 Q19 100 20 95 Z
                     M57 63 L63 73 H51 L57 63 Z"/>
          </svg>
        </div>
        <div>Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø°ÙƒÙŠ <span class="en">| Smart Trainer Pro</span></div>
        <div class="persona">Ù…ØµÙ…Ù… Ø®ØµÙŠØµÙ‹Ø§ Ù„Ù€ Ø£Ù…Ø§Ù†ÙŠ <span class="en">| Custom-made for Amani</span></div>
      </div>
      <div class="controls">
        <button class="btn" id="langBtn"><i class="fa-solid fa-language"></i><span data-i18n="lang">English</span></button>
        <button class="btn" id="themeBtn"><i class="fa-solid fa-circle-half-stroke"></i><span data-i18n="theme">ÙˆØ¶Ø¹ ÙØ§ØªØ­</span></button>
        <button class="btn" id="installBtn" style="display:none"><i class="fa-solid fa-download"></i><span data-i18n="install">ØªØ«Ø¨ÙŠØª PWA</span></button>
        <button class="btn" onclick="window.print()"><i class="fa-solid fa-print"></i><span data-i18n="print">Ø·Ø¨Ø§Ø¹Ø©</span></button>
      </div>
    </header>

    <!-- API Key -->
    <div class="api-key fadeIn" style="margin:14px 0; background:var(--glass); border:1px solid var(--border); padding:10px 12px; border-radius:14px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
      <i class="fa-solid fa-key"></i>
      <input id="apiKey" type="password" placeholder="Gemini API Key" style="flex:1; min-width:220px" />
      <button class="btn" id="saveKey"><i class="fa-regular fa-floppy-disk"></i><span data-i18n="saveKey">Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­</span></button>
      <small class="meta" data-i18n="keyHint">Ù„Ù† ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØªÙ… ØªØ®Ø²ÙŠÙ†Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙ‚Ø·.</small>
    </div>

    <!-- Tabs -->
    <div class="tabs actions-toolbar">
      <button class="tab active" data-tab="library" data-i18n="tabLibrary">Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</button>
      <button class="tab" data-tab="planner" data-i18n="tabPlanner">Ù…ÙØ®Ø·ÙÙ‘Ø· Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† (Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ)</button>
      <button class="tab" data-tab="plans" data-i18n="tabMyPlans">Ø®Ø·Ø·ÙŠ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</button>
    </div>

    <!-- Library Panel -->
    <section id="panel-library" class="panel active fadeIn">
      <div class="searchbar">
        <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø£Ùˆ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©â€¦" />
        <button class="btn" id="clearSearch"><i class="fa-solid fa-xmark"></i><span data-i18n="clear">Ù…Ø³Ø­</span></button>
      </div>
      <div class="chips" id="groupChips"></div>
      <div class="grid" id="exerciseGrid"></div>
    </section>

    <!-- Planner Panel -->
    <section id="panel-planner" class="panel fadeIn">
      <div class="fieldset">
        <div class="field">
          <label data-i18n="goal">Ø§Ù„Ù‡Ø¯Ù</label>
          <select id="goal">
            <option value="hypertrophy" selected>Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª</option>
            <option value="fatloss">Ø­Ø±Ù‚ Ø§Ù„Ø¯Ù‡ÙˆÙ†</option>
            <option value="strength">Ø§Ù„Ù‚ÙˆØ©</option>
            <option value="endurance">Ø§Ù„ØªÙ‘Ø­Ù…Ù‘Ù„</option>
            <option value="focus">ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ù…Ù†Ø·Ù‚Ø©</option>
          </select>
        </div>
        <div class="field">
          <label data-i18n="equipment">Ø§Ù„Ù…Ø¹Ø¯Ø§Øª</label>
          <select id="equipment" multiple size="5">
            <option value="gym" selected>Ø¬ÙŠÙ… ÙƒØ§Ù…Ù„</option>
            <option value="dumbbells">Ø¯Ù…Ø¨Ù„Ø²</option>
            <option value="bands">Ù…Ø·Ø§Ø·/Ø±Ø¨Ø§Ø·</option>
            <option value="bodyweight">ÙˆØ²Ù† Ø§Ù„Ø¬Ø³Ù…</option>
            <option value="kettlebell">ÙƒØ§ØªÙ„ Ø¨ÙŠÙ„</option>
          </select>
          <small class="meta" data-i18n="equipHint">ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ø®ÙŠØ§Ø± (Ctrl/âŒ˜)</small>
        </div>
        <div class="field">
          <label data-i18n="days">Ø§Ù„Ø£ÙŠØ§Ù…/Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
          <select id="days">
            <option>3</option>
            <option selected>4</option>
            <option>5</option>
            <option>6</option>
          </select>
        </div>
        <div class="field">
          <label data-i18n="level">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
          <select id="level">
            <option>Ù…Ø¨ØªØ¯Ø¦</option>
            <option selected>Ù…ØªÙˆØ³Ø·</option>
            <option>Ù…ØªÙ‚Ø¯Ù…</option>
          </select>
        </div>
        <div class="field">
          <label data-i18n="focusArea">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ±ÙƒÙŠØ² (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="focusArea" placeholder="Ù…Ø«Ø§Ù„: ØµØ¯Ø±ØŒ Ø¸Ù‡Ø±ØŒ Ø£Ø±Ø¯Ø§Ùâ€¦" />
        </div>
      </div>
      <div class="actions" style="margin:8px 0 14px">
        <button class="btn primary" id="genGemini"><i class="fa-solid fa-wand-magic-sparkles"></i><span data-i18n="genGemini">ØªÙˆÙ„ÙŠØ¯ Ø¨ÙˆØ§Ø³Ø·Ø© Gemini</span></button>
        <button class="btn" id="genLocal"><i class="fa-solid fa-bolt"></i><span data-i18n="genLocal">ØªÙˆÙ„ÙŠØ¯ Ù…Ø­Ù„ÙŠ (Ø¨Ø¯ÙˆÙ† Ù…ÙØªØ§Ø­)</span></button>
        <button class="btn" id="savePlan"><i class="fa-regular fa-bookmark"></i><span data-i18n="savePlan">Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø©</span></button>
      </div>
      <div class="plan" id="planOutput" aria-live="polite"></div>
    </section>

    <!-- My Plans Panel -->
    <section id="panel-plans" class="panel fadeIn">
      <div id="plansList" class="grid"></div>
    </section>

    <footer>
      <div>Â© <span id="year"></span> Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø°ÙƒÙŠ â€” <span class="en">Smart Trainer Pro</span>. <span data-i18n="foot">ØªØ·Ø¨ÙŠÙ‚ ÙˆÙŠØ¨ ØªÙ‚Ø¯Ù…ÙŠ ÙŠØ¹Ù…Ù„ Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„.</span></div>
    </footer>
  </div>

  <script>
    /* ---------------- I18N ---------------- */
    const STR = {
      ar:{lang:'English', theme:'ÙˆØ¶Ø¹ ÙØ§ØªØ­', install:'ØªØ«Ø¨ÙŠØª PWA', print:'Ø·Ø¨Ø§Ø¹Ø©',
          tabLibrary:'Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†', tabPlanner:'Ù…ÙØ®Ø·ÙÙ‘Ø· Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† (Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ)', tabMyPlans:'Ø®Ø·Ø·ÙŠ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©',
          clear:'Ù…Ø³Ø­', goal:'Ø§Ù„Ù‡Ø¯Ù', equipment:'Ø§Ù„Ù…Ø¹Ø¯Ø§Øª', equipHint:'ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ø®ÙŠØ§Ø± (Ctrl/âŒ˜)', days:'Ø§Ù„Ø£ÙŠØ§Ù…/Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', level:'Ø§Ù„Ù…Ø³ØªÙˆÙ‰',
          focusArea:'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ±ÙƒÙŠØ² (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)', genGemini:'ØªÙˆÙ„ÙŠØ¯ Ø¨ÙˆØ§Ø³Ø·Ø© Gemini', genLocal:'ØªÙˆÙ„ÙŠØ¯ Ù…Ø­Ù„ÙŠ (Ø¨Ø¯ÙˆÙ† Ù…ÙØªØ§Ø­)', savePlan:'Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø©',
          foot:'ØªØ·Ø¨ÙŠÙ‚ ÙˆÙŠØ¨ ØªÙ‚Ø¯Ù…ÙŠ ÙŠØ¹Ù…Ù„ Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„. Ø§Ù„ÙˆØ³Ø§Ø¦Ø· ØªÙØ­Ù…Ù‘Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…ØªØ¹Ø¯Ø¯Ø©.', saveKey:'Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­', keyHint:'Ù„Ù† ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØªÙ… ØªØ®Ø²ÙŠÙ†Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙ‚Ø·.'},
      en:{lang:'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', theme:'Light Mode', install:'Install PWA', print:'Print',
          tabLibrary:'Exercise Library', tabPlanner:'AI Workout Planner', tabMyPlans:'My Plans',
          clear:'Clear', goal:'Goal', equipment:'Equipment', equipHint:'You can select multiple (Ctrl/âŒ˜)', days:'Days/Week', level:'Experience',
          focusArea:'Focus Area (optional)', genGemini:'Generate with Gemini', genLocal:'Generate Locally (No Key)', savePlan:'Save Plan',
          foot:'Progressive Web App. Media loads from multiple sources.', saveKey:'Save Key', keyHint:'Key is stored locally only.'}
    };
    let LANG = localStorage.getItem('lang') || 'ar';
    function applyLang(){
      const dict = STR[LANG];
      document.documentElement.lang = LANG === 'ar' ? 'ar' : 'en';
      document.documentElement.dir = LANG === 'ar' ? 'rtl' : 'ltr';
      document.body.classList.toggle('en', LANG==='en');
      document.querySelectorAll('[data-i18n]').forEach(el=>{ el.textContent = dict[el.dataset.i18n] || el.textContent; });
      const s = document.getElementById('search'); if(s) s.placeholder = LANG==='ar'? 'Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø£Ùˆ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©â€¦':'Search exercises in Arabic or Englishâ€¦';
      renderGroupChips(); renderExercises();
    }

    /* ---------------- Media system ---------------- */
    const MEDIA_OVERRIDES_KEY = 'media_overrides_v1';
    const mediaOverrides = JSON.parse(localStorage.getItem(MEDIA_OVERRIDES_KEY)||'{}');
    const exerciseCache = {};

    function slugName(name){
      return name.replace(/\((.*?)\)/g,'').replace(/[^A-Za-z0-9 ]+/g,' ').trim().replace(/\s+/g,'-').replace(/-+/g,'-');
    }
    function ytSearchUrl(name){
      return `https://www.youtube.com/results?search_query=${encodeURIComponent(name+' form tutorial '+(LANG==='ar'?'ar':'en'))}`;
    }
    function ytSearchEmbedUrl(name){
      const q = name + ' exercise form ' + (LANG==='ar'?'arabic':'english');
      return `https://www.youtube-nocookie.com/embed?rel=0&modestbranding=1&playsinline=1&listType=search&list=${encodeURIComponent(q)}`;
    }
    async function getFromExerciseDB(name){
      try{
        const r = await fetch(`https://exercisedb.dev/api/v1/exercises/search?q=${encodeURIComponent(name)}&limit=1`, {mode:'cors'});
        if(!r.ok) return null; const j = await r.json(); return j?.data?.[0]?.gifUrl || null;
      }catch{ return null; }
    }
    function fpCandidates(name){
      const base='https://fitnessprogramer.com/wp-content/uploads/';
      const s = slugName(name);
      const c = [`2021/02/${s}.gif`,`2022/02/${s}.gif`,`2021/05/${s}.gif`].map(p=>base+p);
      const prox = c.map(u=> 'https://images.weserv.nl/?url='+encodeURIComponent(u.replace(/^https?:\/\//,'')));
      return [...c, ...prox];
    }
    async function resolveMedia(name){
      const key=name.toLowerCase(); if(exerciseCache[key]) return exerciseCache[key];

      if(mediaOverrides[key]){
        const url=mediaOverrides[key];
        exerciseCache[key]={kind:/\.(mp4|webm)(\?|$)/i.test(url)?'video':'image', url, provider:'Custom'};
        return exerciseCache[key];
      }

      const exdb=await getFromExerciseDB(name);
      if(exdb){ exerciseCache[key]={kind:'image', url:exdb, provider:'ExerciseDB'}; return exerciseCache[key]; }

      const fps=fpCandidates(name);
      if(fps.length){ exerciseCache[key]={kind:'image', url:fps[0], provider:'FitnessProgramer (guess)', fallbackList:fps.slice(1)}; return exerciseCache[key]; }

      exerciseCache[key]={kind:'yt', url:ytSearchEmbedUrl(name), provider:'YouTube'};
      return exerciseCache[key];
    }
    function editMedia(name, onSaved){
      const key=name.toLowerCase(); const cur=mediaOverrides[key]||'';
      const msg = LANG==='ar'?'Ø£Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· GIF/MP4 Ù„Ù‡Ø°Ø§ Ø§Ù„ØªÙ…Ø±ÙŠÙ†:':'Paste GIF/MP4 URL for this exercise:';
      const u = prompt(msg, cur);
      if(u!==null){ const v=u.trim(); if(v) mediaOverrides[key]=v; else delete mediaOverrides[key]; localStorage.setItem(MEDIA_OVERRIDES_KEY, JSON.stringify(mediaOverrides)); onSaved&&onSaved(); }
    }
    function mountYTEmbed(container, name){
  container.innerHTML='';

  // Header UI
  const prov=document.createElement('div'); prov.className='provider'; prov.textContent='YouTube';
  const bar=document.createElement('div'); bar.style.display='flex'; bar.style.gap='8px'; bar.style.alignItems='center';
  bar.appendChild(prov);

  const setBtn=document.createElement('button'); 
  setBtn.className='edit'; 
  setBtn.title=LANG==='ar'?'ØªØ­Ø¯ÙŠØ¯ ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨ Ù…Ø¨Ø§Ø´Ø±Ø©':'Set direct YouTube video';
  setBtn.textContent='ğŸ¬';
  setBtn.onclick=()=>{
    const prev = localStorage.getItem(`yt:videoId:${name}`) || (window.YT_VIDEO_IDS && window.YT_VIDEO_IDS[name]) || '';
    const val = prompt(LANG==='ar'?'Ø£Ù„ØµÙ‚ Ø±Ø§Ø¨Ø·/Ù…Ø¹Ø±Ù‘Ù YouTube':'Paste YouTube URL/ID', prev||'');
    if(!val) return;
    const id = extractYouTubeId(val);
    if(id){
      localStorage.setItem(`yt:videoId:${name}`, id);
      mountMedia(container, name);
    }else{
      alert(LANG==='ar'?'ØªØ¹Ø°Ù‘Ø± Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¹Ø±Ù Ù…Ù† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„.':'Could not extract a video ID from your input.');
    }
  };
  bar.appendChild(setBtn);

  const edit=document.createElement('button'); 
  edit.className='edit'; 
  edit.title=LANG==='ar'?'Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·':'Override media';
  edit.innerHTML='âš™ï¸'; 
  edit.onclick=()=>editMedia(name,()=>mountMedia(container,name)); 
  bar.appendChild(edit);
  container.appendChild(bar);

  // Determine the best videoId to embed
  const directId = (window.YT_VIDEO_IDS && window.YT_VIDEO_IDS[name]) || localStorage.getItem(`yt:videoId:${name}`);

  function extractYouTubeId(input){
    if(!input) return null;
    const str = String(input).trim();
    // plain 11-char ID
    const idMatch = str.match(/^[a-zA-Z0-9_-]{11}$/);
    if(idMatch) return idMatch[0];
    // common URL patterns
    const patterns = [
      /[?&]v=([a-zA-Z0-9_-]{11})/,               // watch?v=
      /youtu\.be\/([a-zA-Z0-9_-]{11})/,           // youtu.be/<id>
      /youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/, // embed/<id>
      /youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/ // shorts/<id>
    ];
    for(const p of patterns){
      const m = str.match(p);
      if(m) return m[1];
    }
    return null;
  }

  function youtubeEmbedSrcFromId(id){
    const origin = encodeURIComponent(location.origin);
    return `https://www.youtube-nocookie.com/embed/${id}?rel=0&modestbranding=1&playsinline=1&origin=${origin}`;
  }

  const frame = document.createElement('iframe');
  frame.loading='lazy';
  frame.allow='accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
  frame.referrerPolicy='origin';
  frame.style.width='100%';
  frame.style.height='100%';
  container.appendChild(frame);

  // If a direct ID is available, use it immediately (no search/fallback)
  const directResolved = extractYouTubeId(directId);
  if(directResolved){
    frame.src = youtubeEmbedSrcFromId(directResolved);
    return;
  }

  // Otherwise, best-effort search based on the exercise name
  const q = name + ' exercise form ' + (LANG==='ar'?'arabic':'english');

  async function fetchFirstYoutubeId(query){
    const enc = encodeURIComponent(query);
    // 1) Piped
    try{
      const r = await fetch(`https://piped.video/api/v1/search?q=${enc}&region=US`, {mode:'cors'});
      if(r.ok){
        const j = await r.json();
        const vid = (j?.items||[]).find(x=>x.type==='video')?.id || null;
        if(vid && typeof vid === 'string' && vid.length<=15) return vid;
      }
    }catch{}
    // 2) Invidious
    try{
      const r = await fetch(`https://yewtu.be/api/v1/search?q=${enc}&type=video`, {mode:'cors'});
      if(r.ok){
        const j = await r.json();
        const vid = (Array.isArray(j) && j.length) ? (j[0].videoId || null) : null;
        if(vid && typeof vid === 'string' && vid.length<=15) return vid;
      }
    }catch{}
    // 3) HTML proxy
    try{
      const r = await fetch(`https://r.jina.ai/http://www.youtube.com/results?search_query=${enc}`, {mode:'cors'});
      if(r.ok){
        const t = await r.text();
        const m = t.match(/watch\\?v=([a-zA-Z0-9_-]{11})/);
        if(m) return m[1];
      }
    }catch{}
    return null;
  }

  (async ()=>{
    try{
      const id = await fetchFirstYoutubeId(q);
      if(id){ frame.src = youtubeEmbedSrcFromId(id); return; }
    }catch{}
    // Fallback: clickable search link
    frame.remove();
    const link = document.createElement('a');
    link.href = `https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`;
    link.target = '_blank'; link.rel='noopener';
    link.style.display='grid'; link.style.placeItems='center'; link.style.height='100%'; link.style.textDecoration='none';
    link.textContent = LANG==='ar' ? 'ÙØªØ­ Ù†ØªØ§Ø¦Ø¬ ÙŠÙˆØªÙŠÙˆØ¨ ÙÙŠ ØªØ¨ÙˆÙŠØ¨' : 'Open YouTube results';
    container.appendChild(link);
  })();
}

  async function mountMedia(container, name){
      container.innerHTML='';
      const prov=document.createElement('div'); prov.className='provider'; prov.textContent='â€¦'; container.appendChild(prov);
      const edit=document.createElement('button'); edit.className='edit'; edit.title= LANG==='ar'?'Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·':'Override media'; edit.innerHTML='âš™ï¸'; edit.onclick=()=>editMedia(name,()=>mountMedia(container,name)); container.appendChild(edit);

      const info = await resolveMedia(name);
      prov.textContent = info.provider;

      
      if(info.kind==='video'){
        const v=document.createElement('video');
        v.controls=true;
        v.muted=true;            // allow autoplay on most browsers
        v.autoplay=true;
        v.loop=true;
        v.playsInline=true;
        v.setAttribute('playsinline','');
        v.preload='metadata';
        v.referrerPolicy='no-referrer';
        v.loading='lazy';
        v.src=info.url;
        v.onerror=()=>mountYTEmbed(container,name);
        container.appendChild(v);
        return;
      }
      if(info.kind==='yt'){ mountYTEmbed(container,name); return; }

      const img=document.createElement('img'); img.referrerPolicy='no-referrer'; img.loading='lazy';
      const list=[info.url,...(info.fallbackList||[])]; let i=0;
      img.onerror=()=>{ i++; if(i<list.length){ img.src=list[i]; try{prov.textContent=new URL(list[i].split('?')[0]).hostname.replace('www.','');}catch{} } else { mountYTEmbed(container,name); } };
      img.onload = ()=>{ try{prov.textContent=new URL(list[i].split('?')[0]).hostname.replace('www.','');}catch{} };
      img.src=list[i]; container.appendChild(img);
    }

    /* -------------- Groups & Exercises (70+ items) -------------- */
    const TYPE_META = {
      compound:{ sets:'4Ã—6â€“8', tempo:'2-1-2', rest:'120s', tip:'Ø´Ø¯ Ù„ÙˆØ­ÙŠ Ø§Ù„ÙƒØªÙ ÙˆØ«Ø¨Ù‘Øª Ø§Ù„Ø¬Ø°Ø¹', warn:'ØªØ¬Ù†Ù‘Ø¨ ØªÙ‚ÙˆÙ‘Ø³ Ø£Ø³ÙÙ„ Ø§Ù„Ø¸Ù‡Ø±' },
      strength:{ sets:'5Ã—3â€“5', tempo:'2-0-2', rest:'150s', tip:'Ø§Ø¯ÙØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø¯Ø§Ù… ÙˆØ£Ø¨Ù‚Ù Ø§Ù„Ø¹Ù…ÙˆØ¯ Ù…Ø­Ø§ÙŠØ¯Ù‹Ø§', warn:'Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø§Ù†Ø¯ÙØ§Ø¹' },
      isolation:{ sets:'3Ã—10â€“15', tempo:'2-1-2', rest:'60â€“75s', tip:'ØªØ­ÙƒÙ‘Ù… Ø¨Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ§Ø¹ØµØ± ÙÙŠ Ø§Ù„Ù‚Ù…Ø©', warn:'Ù„Ø§ ØªØ±ÙØ¹ ÙƒØªÙÙŠÙƒ' }
    };
    const GROUPS = [
      {id:'chest', ar:'Ø§Ù„ØµØ¯Ø±', en:'Chest'},
      {id:'back', ar:'Ø§Ù„Ø¸Ù‡Ø±', en:'Back'},
      {id:'legs', ar:'Ø§Ù„Ø£Ø±Ø¬Ù„', en:'Legs'},
      {id:'shoulders', ar:'Ø§Ù„ÙƒØªÙ', en:'Shoulders'},
      {id:'arms', ar:'Ø§Ù„Ø°Ø±Ø§Ø¹', en:'Arms'},
      {id:'core', ar:'Ø§Ù„Ø¬Ø°Ø¹', en:'Core'},
      {id:'bonus', ar:'Ø£Ø±Ø¯Ø§Ù/Ù…Ù†Ø²Ù„ÙŠ', en:'Glutes & Home'}
    ];
    function groupIdFrom(ar){ return GROUPS.find(g=>g.ar===ar)?.id || 'other'; }
    function ex(groupAr, groupEn, nameAr, nameEn, type='compound', badges=['Ù…Ù‡Ù…'], sourcePath='', equip=['gym']){
      const meta = TYPE_META[type] || TYPE_META.compound;
      return {
        groupId: groupIdFrom(groupAr), groupAr, groupEn, nameAr, nameEn,
        sets: meta.sets, reps: '', tempo: meta.tempo, rest: meta.rest, type, badges,
        equip, source: sourcePath ? `https://fitnessprogramer.com/${sourcePath}` : '#'
      };
    }

    const EX = [
      /* --- Chest --- */ ex('Ø§Ù„ØµØ¯Ø±','Chest','Ø¶ØºØ· Ø§Ù„ØµØ¯Ø± Ø¨Ø§Ù„Ø¨Ø§Ø±','Barbell Bench Press','compound',['Ø§Ù„Ø£ÙØ¶Ù„'],'exercise/bench-press/'),
      ex('Ø§Ù„ØµØ¯Ø±','Chest','Ø¶ØºØ· Ù…Ø§Ø¦Ù„ Ø¨Ø§Ù„Ø¯Ù…Ø¨Ù„','Incline Dumbbell Press','compound',['Ù…Ù‡Ù…'],'exercise/incline-dumbbell-press/',['gym','dumbbells']),
      ex('Ø§Ù„ØµØ¯Ø±','Chest','Ø¶ØºØ· Ø§Ù„ØµØ¯Ø± Ø¨Ø§Ù„Ø¢Ù„Ø©','Machine Chest Press','compound',['Ù…Ù‡Ù…'],'exercise/chest-press-machine/'),
      ex('Ø§Ù„ØµØ¯Ø±','Chest','Ø¶ØºØ· Ù…Ø§Ø¦Ù„ Ø¨Ø§Ù„Ø¨Ø§Ø±','Incline Barbell Bench Press','compound',['Ù…Ù‡Ù…'],'exercise/incline-bench-press/'),
      ex('Ø§Ù„ØµØ¯Ø±','Chest','Ø¶ØºØ· Ù…Ù†Ø­Ø¯Ø± Ø¨Ø§Ù„Ø¯Ù…Ø¨Ù„','Decline Dumbbell Press','compound',['Ù…Ù‡Ù…'],'exercise/decline-dumbbell-bench-press/',['gym','dumbbells']),
      ex('Ø§Ù„ØµØ¯Ø±','Chest','ÙÙ„Ø§ÙŠ Ø¨Ø§Ù„Ø¯Ù…Ø¨Ù„','Dumbbell Chest Fly','isolation',['Ø¹Ø²Ù„'],'exercise/dumbbell-fly/',['gym','dumbbells']),
      ex('Ø§Ù„ØµØ¯Ø±','Chest','ÙÙ„Ø§ÙŠ ÙƒØ§Ø¨Ù„','Cable Crossover','isolation',['Ø¹Ø²Ù„'],'exercise/cable-crossover/'),
      ex('Ø§Ù„ØµØ¯Ø±','Chest','Ø¶ØºØ· Ø£Ø±Ø¶ÙŠ Ø¨Ø§Ù„Ø¯Ù…Ø¨Ù„','Dumbbell Floor Press','compound',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['dumbbells']),
      ex('Ø§Ù„ØµØ¯Ø±','Chest','ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø¶ØºØ·','Push-Up','compound',['Ù…Ù†Ø²Ù„ÙŠ','Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight']),
      ex('Ø§Ù„ØµØ¯Ø±','Chest','ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø¶ØºØ· Ù…Ø§Ø¦Ù„','Incline Push-Up','compound',['Ù…Ù†Ø²Ù„ÙŠ','Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight']),
      ex('Ø§Ù„ØµØ¯Ø±','Chest','ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø¶ØºØ· Ø¯ÙŠÙƒÙ„ÙŠÙ†','Decline Push-Up','compound',['Ù…Ù†Ø²Ù„ÙŠ','Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight']),
      ex('Ø§Ù„ØµØ¯Ø±','Chest','Ø¯ÙŠØ¨Ø³ Ù„Ù„ØµØ¯Ø±','Chest Dips','compound',['Ù…Ù‡Ù…'], 'exercise/chest-dips/',['gym','bodyweight']),
      ex('Ø§Ù„ØµØ¯Ø±','Chest','Ø¨ÙˆÙ„ÙˆÙØ± Ø¯Ù…Ø¨Ù„','Dumbbell Pullover','isolation',['Ø¹Ø²Ù„'], 'exercise/dumbbell-pullover/',['gym','dumbbells']),
      ex('Ø§Ù„ØµØ¯Ø±','Chest','ÙÙ„Ø§ÙŠ Ø¢Ù„Ø©','Pec Deck Fly','isolation',['Ø¹Ø²Ù„'],'exercise/pec-deck/'),

      /* --- Back --- */ ex('Ø§Ù„Ø¸Ù‡Ø±','Back','Ø§Ù„Ø±ÙØ¹Ø© Ø§Ù„Ù…ÙŠØªØ©','Conventional Deadlift','strength',['Ø§Ù„Ø£ÙØ¶Ù„'],'exercise/deadlift/'),
      ex('Ø§Ù„Ø¸Ù‡Ø±','Back','Ø³Ø­Ø¨ Ø£Ø±Ø¶ÙŠ Ø¨Ø§Ù„Ø¨Ø§Ø±','Barbell Bent-Over Row','compound',['Ù…Ù‡Ù…'],'exercise/bent-over-row/'),
      ex('Ø§Ù„Ø¸Ù‡Ø±','Back','Ø³Ø­Ø¨ Ø¹Ù„ÙˆÙŠ','Lat Pulldown','compound',['Ù…Ù‡Ù…'],'exercise/lat-pulldown/'),
      ex('Ø§Ù„Ø¸Ù‡Ø±','Back','Ø¹Ù‚Ù„Ø© Ø¹Ø±ÙŠØ¶Ø©','Wide-Grip Pull-Up','compound',['Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight','gym']),
      ex('Ø§Ù„Ø¸Ù‡Ø±','Back','Ø¹Ù‚Ù„Ø© Ù…Ø¹ÙƒÙˆØ³Ø©','Chin-Up','compound',['Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight','gym']),
      ex('Ø§Ù„Ø¸Ù‡Ø±','Back','Ø³Ø­Ø¨ Ø¬Ø§Ù„Ø³ ÙƒØ§Ø¨Ù„','Seated Cable Row','compound',['Ù…Ù‡Ù…'],'exercise/seated-cable-row/'),
      ex('Ø§Ù„Ø¸Ù‡Ø±','Back','T-Bar Ø±Ùˆ','T-Bar Row','compound',['Ù…Ù‡Ù…'],'exercise/t-bar-row/'),
      ex('Ø§Ù„Ø¸Ù‡Ø±','Back','Ø³Ø­Ø¨ Ø°Ø±Ø§Ø¹ ÙˆØ§Ø­Ø¯Ø© Ø¯Ù…Ø¨Ù„','One-Arm Dumbbell Row','compound',['Ù…Ù†Ø²Ù„ÙŠ'],'exercise/one-arm-dumbbell-row/',['gym','dumbbells']),
      ex('Ø§Ù„Ø¸Ù‡Ø±','Back','Ø³Ø­Ø¨ Ø°Ø±Ø§Ø¹ Ù…Ø³ØªÙ‚ÙŠÙ…Ø©','Straight-Arm Pulldown','isolation',['Ø¹Ø²Ù„'],'exercise/straight-arm-pulldown/'),
      ex('Ø§Ù„Ø¸Ù‡Ø±','Back','Ø³Ø­Ø¨ ØµØ¯Ø± Ù…Ø¯Ø¹Ù‘Ù…','Chest-Supported Row','compound',['Ù…Ù‡Ù…'],'exercise/chest-supported-row/'),
      ex('Ø§Ù„Ø¸Ù‡Ø±','Back','Ø±Ùˆ Ù…Ø¹ÙƒÙˆØ³Ø©','Inverted Row','compound',['Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight','gym']),
      ex('Ø§Ù„Ø¸Ù‡Ø±','Back','Ø¬ÙˆØ¯ Ù…ÙˆØ±Ù†ÙŠÙ†Ø¬','Good Morning','strength',['ØªÙ‚ÙˆÙŠØ©'], 'exercise/good-morning/'),
      ex('Ø§Ù„Ø¸Ù‡Ø±','Back','Ø±Ùˆ Ù…ÙŠØ¯ÙˆØ²','Meadows Row','compound',['Ù…ØªÙ‚Ø¯Ù…'], '', ['gym','dumbbells']),
      ex('Ø§Ù„Ø¸Ù‡Ø±','Back','Ø³Ø­Ø¨ Ø­Ø¨Ù„ Ù„Ù„ÙˆØ¬Ù‡','Face Pull','isolation',['Ø¹Ø²Ù„'],'exercise/face-pull/'),

      /* --- Legs --- */ ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ø³ÙƒÙˆØ§Øª Ø¸Ù‡Ø±','Back Squat','strength',['Ø§Ù„Ø£ÙØ¶Ù„'],'exercise/squat/'),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ø³ÙƒÙˆØ§Øª Ø£Ù…Ø§Ù…ÙŠ','Front Squat','strength',['Ù…Ù‡Ù…'],'exercise/front-squat/'),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ø³ÙˆÙ…Ùˆ Ø¯ÙŠØ¯ Ù„ÙØª','Sumo Deadlift','strength',['Ù…Ù‡Ù…'],'exercise/sumo-deadlift/'),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ù„Ø§Ù†Ø¬Ø² Ù…Ø´ÙŠ','Walking Lunges','compound',['Ù…Ù‡Ù…'],'exercise/walking-lunge/',['gym','dumbbells','bodyweight']),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ù„Ø§Ù†Ø¬Ø² Ø¨Ù„ØºØ§Ø±ÙŠ','Bulgarian Split Squat','compound',['Ù…Ù†Ø²Ù„ÙŠ'],'exercise/bulgarian-split-squat/',['gym','dumbbells','bodyweight']),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ù‡Ø§Ùƒ Ø³ÙƒÙˆØ§Øª','Hack Squat','strength',['Ù…Ù‡Ù…'],'exercise/hack-squat/'),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ù„ÙŠØ¬ Ø¨Ø±Ø³','Leg Press','compound',['Ù…Ù‡Ù…'],'exercise/leg-press/'),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ø±ÙˆÙ…Ø§Ù†ÙŠØ§Ù† Ø¯ÙŠØ¯Ù„ÙØª','Romanian Deadlift','strength',['Ù…Ù‡Ù…'],'exercise/romanian-deadlift/'),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ø§ÙƒØ³ØªÙ†Ø´Ù† Ø§Ù„Ø£Ø±Ø¬Ù„','Leg Extension','isolation',['Ø¹Ø²Ù„'],'exercise/leg-extension/'),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','ÙƒÙŠØ±Ù„ Ù‡Ø§Ù…Ø³ØªØ±Ù†Ø¬','Lying Leg Curl','isolation',['Ø¹Ø²Ù„'],'exercise/lying-leg-curl/'),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','ÙƒÙŠØ±Ù„ Ù‡Ø§Ù…Ø³ØªØ±Ù†Ø¬ Ø¬Ø§Ù„Ø³','Seated Leg Curl','isolation',['Ø¹Ø²Ù„'],'exercise/seated-leg-curl/'),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ø±ÙØ¹ Ø§Ù„Ø³Ù…Ø§Ù†Ø© ÙˆØ§Ù‚Ù','Standing Calf Raise','isolation',['Ø¹Ø²Ù„'],'exercise/standing-calf-raise/'),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ø±ÙØ¹ Ø§Ù„Ø³Ù…Ø§Ù†Ø© Ø¬Ø§Ù„Ø³','Seated Calf Raise','isolation',['Ø¹Ø²Ù„'],'exercise/seated-calf-raise/'),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ù†ÙˆØ±Ø¯Ùƒ ÙƒÙŠØ±Ù„','Nordic Hamstring Curl','strength',['Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight','gym']),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ù‚ÙØ²Ø© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚','Box Jump','compound',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['bodyweight']),
      ex('Ø§Ù„Ø£Ø±Ø¬Ù„','Legs','Ø³ÙŠØ³ÙŠ Ø³ÙƒÙˆØ§Øª','Sissy Squat','isolation',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['bodyweight','gym']),

      /* --- Shoulders --- */ ex('Ø§Ù„ÙƒØªÙ','Shoulders','Ø¶ØºØ· ÙƒØªÙ Ø¨Ø§Ø±','Barbell Overhead Press','compound',['Ø§Ù„Ø£ÙØ¶Ù„'],'exercise/overhead-press/'),
      ex('Ø§Ù„ÙƒØªÙ','Shoulders','Ø¶ØºØ· ÙƒØªÙ Ø¯Ù…Ø¨Ù„','Dumbbell Shoulder Press','compound',['Ù…Ù‡Ù…'],'exercise/dumbbell-shoulder-press/',['gym','dumbbells']),
      ex('Ø§Ù„ÙƒØªÙ','Shoulders','Ø±ÙØ±ÙØ© Ø¬Ø§Ù†Ø¨ÙŠØ©','Lateral Raise','isolation',['Ø¹Ø²Ù„'],'exercise/dumbbell-lateral-raise/',['gym','dumbbells']),
      ex('Ø§Ù„ÙƒØªÙ','Shoulders','Ø±ÙØ±ÙØ© Ø®Ù„ÙÙŠØ©','Rear Delt Fly','isolation',['Ø¹Ø²Ù„'],'exercise/reverse-pec-deck/',['gym','dumbbells']),
      ex('Ø§Ù„ÙƒØªÙ','Shoulders','ÙØ±ÙˆÙ†Øª Ø±ÙŠØ²','Front Raise','isolation',['Ø¹Ø²Ù„'],'exercise/front-raise/',['gym','dumbbells']),
      ex('Ø§Ù„ÙƒØªÙ','Shoulders','Ø£Ø±Ù†ÙˆÙ„Ø¯ Ø¨Ø±Ø³','Arnold Press','compound',['Ù…ØªÙˆØ³Ø·'],'exercise/arnold-press/',['gym','dumbbells']),
      ex('Ø§Ù„ÙƒØªÙ','Shoulders','ÙƒØ§Ø¨Ù„ Ø±ÙØ±ÙØ© Ø¬Ø§Ù†Ø¨ÙŠØ©','Cable Lateral Raise','isolation',['Ø¹Ø²Ù„'],'exercise/cable-lateral-raise/'),
      ex('Ø§Ù„ÙƒØªÙ','Shoulders','Ø³Ø­Ø¨ Ù„Ù„ÙˆØ¬Ù‡ (ÙƒØ§Ø¨Ù„)','Face Pull (Cable)','isolation',['Ø¹Ø²Ù„'],'exercise/face-pull/'),
      ex('Ø§Ù„ÙƒØªÙ','Shoulders','ÙŠÙˆ Ø¨Ø±Ø§ÙŠØª Ø±Ùˆ','Upright Row','compound',['Ù…Ù‡Ù…'],'exercise/upright-row/'),
      ex('Ø§Ù„ÙƒØªÙ','Shoulders','Ø±ÙØ±ÙØ© Ø¬Ø§Ù†Ø¨ÙŠØ© ÙˆØ§Ù‚Ù Ø¨Ø§ÙƒØªÙ„ Ø¨ÙŠÙ„','KB Lateral Raise','isolation',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['kettlebell']),
      ex('Ø§Ù„ÙƒØªÙ','Shoulders','Ø¯ÙˆØ±Ø§Ù† ÙƒØªÙ ÙƒÙˆØ¨ÙŠ','Cuban Rotation','isolation',['ØµØ­Ø© ÙƒØªÙ'], '', ['dumbbells','bands','gym']),
      ex('Ø§Ù„ÙƒØªÙ','Shoulders','Ø¶ØºØ· ÙƒØªÙ ÙƒØ§ØªÙ„ Ø¨ÙŠÙ„','Kettlebell Press','compound',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['kettlebell']),

      /* --- Arms --- */ ex('Ø§Ù„Ø°Ø±Ø§Ø¹','Arms','Ø¨Ø§Ø±Ø¨Ù„ ÙƒÙˆØ±Ù„','Barbell Curl','isolation',['Ø¹Ø²Ù„'],'exercise/barbell-curl/'),
      ex('Ø§Ù„Ø°Ø±Ø§Ø¹','Arms','ÙƒÙˆØ±Ù„ Ø¯Ù…Ø¨Ù„ ØªØ¨Ø§Ø¯Ù„ÙŠ','Alternating DB Curl','isolation',['Ø¹Ø²Ù„'],'exercise/alternating-dumbbell-curl/',['gym','dumbbells']),
      ex('Ø§Ù„Ø°Ø±Ø§Ø¹','Arms','Ù‡Ø§Ù…Ø± ÙƒÙˆØ±Ù„','Hammer Curl','isolation',['Ø¹Ø²Ù„'],'exercise/hammer-curl/',['gym','dumbbells']),
      ex('Ø§Ù„Ø°Ø±Ø§Ø¹','Arms','ÙƒÙˆÙ†Ø³Ù†ØªØ±Ø´Ù† ÙƒÙˆØ±Ù„','Concentration Curl','isolation',['Ø¹Ø²Ù„'],'exercise/concentration-curl/',['gym','dumbbells']),
      ex('Ø§Ù„Ø°Ø±Ø§Ø¹','Arms','Ø²ÙˆØªÙ…Ù† ÙƒÙˆØ±Ù„','Zottman Curl','isolation',['Ø¹Ø²Ù„'], '', ['dumbbells']),
      ex('Ø§Ù„Ø°Ø±Ø§Ø¹','Arms','ÙƒÙˆØ±Ù„ ÙƒØ§Ø¨Ù„','Cable Curl','isolation',['Ø¹Ø²Ù„'],'exercise/cable-curl/'),
      ex('Ø§Ù„Ø°Ø±Ø§Ø¹','Arms','Ø³ÙƒÙˆÙ„ ÙƒØ±Ø§Ø´Ø±','Skull Crushers','isolation',['Ù…Ù‡Ù…'],'exercise/skull-crusher/'),
      ex('Ø§Ù„Ø°Ø±Ø§Ø¹','Arms','Ø¶ØºØ· Ø«Ù„Ø§Ø«ÙŠ Ø­Ø¨Ù„','Rope Pushdown','isolation',['Ø¹Ø²Ù„'],'exercise/triceps-pushdown/'),
      ex('Ø§Ù„Ø°Ø±Ø§Ø¹','Arms','Ø£ÙˆÙØ±Ù‡ÙŠØ¯ Ø§ÙƒØ³ØªÙ†Ø´Ù†','Overhead Triceps Extension','isolation',['Ø¹Ø²Ù„'],'exercise/overhead-cable-triceps-extension/',['gym','dumbbells']),
      ex('Ø§Ù„Ø°Ø±Ø§Ø¹','Arms','Ø¯ÙŠØ¨Ø³ Ù„Ù„Ø¹Ø¶Ø¯ Ø§Ù„Ø®Ù„ÙÙŠØ©','Triceps Dips','compound',['Ø¬Ø³Ù…Ùƒ'],'exercise/triceps-dips/',['bodyweight','gym']),
      ex('Ø§Ù„Ø°Ø±Ø§Ø¹','Arms','Ø¶ØºØ· Ø¶ÙŠÙ‚ Ø¨Ø§Ù„Ø¨Ø§Ø±','Close-Grip Bench Press','compound',['Ù…Ù‡Ù…'],'exercise/close-grip-bench-press/'),
      ex('Ø§Ù„Ø°Ø±Ø§Ø¹','Arms','Ø¨Ù†Ø´ Ø¯ÙŠØ¨Ø³','Bench Dips','compound',['Ù…Ù†Ø²Ù„ÙŠ','Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight']),

      /* --- Core --- */ ex('Ø§Ù„Ø¬Ø°Ø¹','Core','Ø¨Ù„Ø§Ù†Ùƒ','Plank','isolation',['Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight']),
      ex('Ø§Ù„Ø¬Ø°Ø¹','Core','Ø¨Ù„Ø§Ù†Ùƒ Ø¬Ø§Ù†Ø¨ÙŠ','Side Plank','isolation',['Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight']),
      ex('Ø§Ù„Ø¬Ø°Ø¹','Core','ÙƒØ±Ù†Ø´','Crunch','isolation',['Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight']),
      ex('Ø§Ù„Ø¬Ø°Ø¹','Core','Ø±ÙØ¹ Ø£Ø±Ø¬Ù„ Ù…Ø¹Ù„Ù‘Ù‚','Hanging Leg Raise','isolation',['Ù…Ù‡Ù…'], '', ['bodyweight','gym']),
      ex('Ø§Ù„Ø¬Ø°Ø¹','Core','Ø¨Ø§ÙŠØ³ÙƒÙ„ ÙƒØ±Ù†Ø´','Bicycle Crunch','isolation',['Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight']),
      ex('Ø§Ù„Ø¬Ø°Ø¹','Core','Ø±ÙˆØ³ÙŠØ§Ù† ØªÙˆÙŠØ³Øª','Russian Twist','isolation',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['bodyweight','dumbbells','kettlebell']),
      ex('Ø§Ù„Ø¬Ø°Ø¹','Core','Ø±ÙˆÙ„ Ø¢ÙˆØª Ab Wheel','Ab Wheel Rollout','isolation',['Ù…ØªÙˆØ³Ø·'], '', ['gym']),
      ex('Ø§Ù„Ø¬Ø°Ø¹','Core','Ø¯ÙŠØ¯ Ø¨Øº','Dead Bug','isolation',['Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight']),
      ex('Ø§Ù„Ø¬Ø°Ø¹','Core','Ù‡ÙˆÙ„Ùˆ Ù‡ÙˆÙ„Ø¯','Hollow Hold','isolation',['Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight']),
      ex('Ø§Ù„Ø¬Ø°Ø¹','Core','Ø¨ÙŠØ±Ø¯ Ø¯ÙˆØº','Bird Dog','isolation',['Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight']),
      ex('Ø§Ù„Ø¬Ø°Ø¹','Core','Ø¨Ø§Ù„ÙˆÙ Ø¨Ø±Ø³','Pallof Press','isolation',['Ø¹Ø²Ù„'], '', ['bands','gym']),
      ex('Ø§Ù„Ø¬Ø°Ø¹','Core','ÙˆÙˆØ¯ ØªØ´ÙˆØ¨ ÙƒØ§Ø¨Ù„','Cable Woodchop','isolation',['Ø¹Ø²Ù„'],'exercise/wood-chop/'),

      /* --- Glutes & Home --- */ ex('Ø£Ø±Ø¯Ø§Ù/Ù…Ù†Ø²Ù„ÙŠ','Glutes & Home','Ù‡ÙŠØ¨ Ø«Ø±Ø³Øª','Barbell Hip Thrust','compound',['Ø§Ù„Ø£ÙØ¶Ù„'],'exercise/hip-thrust/'),
      ex('Ø£Ø±Ø¯Ø§Ù/Ù…Ù†Ø²Ù„ÙŠ','Glutes & Home','Ø¬Ù„ÙˆÙˆØª Ø¨Ø±ÙŠØ¯Ø¬','Glute Bridge','compound',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['bodyweight','dumbbells','gym']),
      ex('Ø£Ø±Ø¯Ø§Ù/Ù…Ù†Ø²Ù„ÙŠ','Glutes & Home','Ø±ÙØ¹Ø© Ø±ÙˆÙ…Ø§Ù†ÙŠØ© Ø±Ø¬Ù„ ÙˆØ§Ø­Ø¯Ø©','Single-Leg RDL','isolation',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['dumbbells','kettlebell','bodyweight']),
      ex('Ø£Ø±Ø¯Ø§Ù/Ù…Ù†Ø²Ù„ÙŠ','Glutes & Home','ÙƒÙŠÙƒ Ø¨Ø§Ùƒ','Glute Kickback','isolation',['Ø¹Ø²Ù„'], '', ['bands','gym']),
      ex('Ø£Ø±Ø¯Ø§Ù/Ù…Ù†Ø²Ù„ÙŠ','Glutes & Home','ÙØ§ÙŠØ± Ù‡Ø§ÙŠØ¯Ø±Ø§Ù†Øª','Fire Hydrant','isolation',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['bodyweight','bands']),
      ex('Ø£Ø±Ø¯Ø§Ù/Ù…Ù†Ø²Ù„ÙŠ','Glutes & Home','ÙƒÙ„Ø§Ù…Ø´ÙŠÙ„','Clamshell','isolation',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['bands']),
      ex('Ø£Ø±Ø¯Ø§Ù/Ù…Ù†Ø²Ù„ÙŠ','Glutes & Home','Ø³ØªÙŠØ¨ Ø£Ø¨','Step-Up','compound',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['dumbbells','bodyweight']),
      ex('Ø£Ø±Ø¯Ø§Ù/Ù…Ù†Ø²Ù„ÙŠ','Glutes & Home','ØºÙˆØ¨Ù„Øª Ø³ÙƒÙˆØ§Øª','Goblet Squat','compound',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['dumbbells','kettlebell']),
      ex('Ø£Ø±Ø¯Ø§Ù/Ù…Ù†Ø²Ù„ÙŠ','Glutes & Home','ÙƒØ§ØªÙ„ Ø¨ÙŠÙ„ Ø³ÙˆÙŠÙ†Øº','Kettlebell Swing','compound',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['kettlebell']),
      ex('Ø£Ø±Ø¯Ø§Ù/Ù…Ù†Ø²Ù„ÙŠ','Glutes & Home','Ù…Ø´ÙŠ Ø¬Ø§Ù†Ø¨ÙŠ Ø¨Ø§Ù„Ø±Ø¨Ø§Ø·','Banded Lateral Walk','isolation',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['bands']),
      ex('Ø£Ø±Ø¯Ø§Ù/Ù…Ù†Ø²Ù„ÙŠ','Glutes & Home','ÙˆØ§Ù„ Ø³ÙØª','Wall Sit','isolation',['Ø¬Ø³Ù…Ùƒ'], '', ['bodyweight']),
      ex('Ø£Ø±Ø¯Ø§Ù/Ù…Ù†Ø²Ù„ÙŠ','Glutes & Home','Ù„Ø§Ù†Ø¬Ø³ ÙƒÙŠØ±ØªØ³ÙŠ','Curtsy Lunge','compound',['Ù…Ù†Ø²Ù„ÙŠ'], '', ['bodyweight','dumbbells'])
    ];

    /* ---------------- UI State ---------------- */
    let currentGroup = 'all';
    let searchTerm = '';
    const yearEl = document.getElementById('year'); yearEl.textContent = new Date().getFullYear();

    // Group chips
    function renderGroupChips(){
      const wrap = document.getElementById('groupChips'); wrap.innerHTML='';
      const all = document.createElement('div'); all.className='chip'+(currentGroup==='all'?' active':''); all.textContent = (LANG==='ar'?'Ø§Ù„ÙƒÙ„':'All');
      all.onclick=()=>{currentGroup='all'; renderGroupChips(); renderExercises();};
      wrap.appendChild(all);
      GROUPS.forEach(g=>{
        const count = EX.filter(e=>e.groupId===g.id).length;
        const chip=document.createElement('div'); chip.className='chip'+(currentGroup===g.id?' active':'');
        chip.textContent = (LANG==='ar'? g.ar:g.en) + ` (${count})`;
        chip.onclick=()=>{currentGroup=g.id; renderGroupChips(); renderExercises();};
        wrap.appendChild(chip);
      });
    }

    // Exercise cards
    function renderExercises(){
      const grid = document.getElementById('exerciseGrid'); grid.innerHTML='';
      const q = searchTerm.trim().toLowerCase();
      let list = EX.filter(e => currentGroup==='all' || e.groupId===currentGroup);
      if(q){
        list = list.filter(e=>
          e.nameAr.toLowerCase().includes(q) ||
          e.nameEn.toLowerCase().includes(q) ||
          e.groupAr.toLowerCase().includes(q) ||
          e.groupEn.toLowerCase().includes(q)
        );
      }
      list.forEach(item=>{
        const card=document.createElement('div'); card.className='card fadeIn';

        const media=document.createElement('div'); media.className='media'; card.appendChild(media);
        mountMedia(media, item.nameEn);
        const overlay=document.createElement('div'); overlay.className='overlay';
        overlay.innerHTML = `<div class="name">${item.nameAr}<span class="en"> | ${item.nameEn}</span></div>
                             <div class="muscle">${item.groupAr}<span class="en"> | ${item.groupEn}</span></div>`;
        media.appendChild(overlay);

        const content=document.createElement('div'); content.className='content';
        const title=document.createElement('div'); title.className='title';
        title.innerHTML = `<strong>${item.nameAr}</strong> <span class="en">| ${item.nameEn}</span>`;
        content.appendChild(title);

        const badges=document.createElement('div'); badges.className='badges';
        item.badges.forEach(b=>{
          const s=document.createElement('span'); s.className='badge'+(b==='Ø§Ù„Ø£ÙØ¶Ù„'?' best':(b==='Ù…Ù†Ø²Ù„ÙŠ'?' home':'')); s.textContent=b; badges.appendChild(s);
        });
        const t=document.createElement('span'); t.className='badge'; t.textContent = item.type==='compound'?(LANG==='ar'?'Ø£Ø³Ø§Ø³ÙŠ':'Compound'): item.type==='strength'?(LANG==='ar'?'Ù‚ÙˆØ©':'Strength'):(LANG==='ar'?'Ø¹Ø²Ù„':'Isolation');
        badges.appendChild(t);
        content.appendChild(badges);

        const meta=document.createElement('div'); meta.className='meta';
        meta.textContent = `${LANG==='ar'?'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª':'Sets'}: ${item.sets} â€¢ ${LANG==='ar'?'Ø§Ù„ØªÙ…Ø¨Ùˆ':'Tempo'}: ${item.tempo} â€¢ ${LANG==='ar'?'Ø±Ø§Ø­Ø©':'Rest'}: ${item.rest}`;
        content.appendChild(meta);

        const actions=document.createElement('div'); actions.className='actions';
        const yt = document.createElement('a'); yt.href=ytSearchUrl(item.nameEn); yt.target='_blank'; yt.rel='noopener'; yt.className='btn'; yt.innerHTML='<i class="fa-brands fa-youtube"></i> YouTube';
        const src = document.createElement('a'); src.href=item.source||'#'; src.target='_blank'; src.rel='noopener'; src.className='btn'; src.innerHTML='<i class="fa-solid fa-book-open"></i> Source';
        actions.appendChild(yt); actions.appendChild(src);
        content.appendChild(actions);

        card.appendChild(content);
        grid.appendChild(card);
      });
    }

    // Search
    document.getElementById('search').addEventListener('input', e=>{ searchTerm=e.target.value; renderExercises(); });
    document.getElementById('clearSearch').addEventListener('click', ()=>{ document.getElementById('search').value=''; searchTerm=''; renderExercises(); });

    // Tabs
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
        document.getElementById('panel-'+btn.dataset.tab).classList.add('active');
      });
    });

    // Theme toggle
    const THEME_KEY='stp_theme';
    function applyTheme(){
      const t=localStorage.getItem(THEME_KEY)||'dark';
      document.documentElement.setAttribute('data-theme', t==='light'?'light':'dark');
      document.querySelector('#themeBtn span').textContent = LANG==='ar'?(t==='light'?'ÙˆØ¶Ø¹ Ø¯Ø§ÙƒÙ†':'ÙˆØ¶Ø¹ ÙØ§ØªØ­'):(t==='light'?'Dark Mode':'Light Mode');
    }
    document.getElementById('themeBtn').addEventListener('click', ()=>{
      const cur=localStorage.getItem(THEME_KEY)||'dark';
      localStorage.setItem(THEME_KEY, cur==='light'?'dark':'light'); applyTheme();
    });

    // Lang toggle
    document.getElementById('langBtn').addEventListener('click', ()=>{ LANG = (LANG==='ar'?'en':'ar'); localStorage.setItem('lang',LANG); applyLang(); });

    // API key
    const KEY_STORE='gemini_api_key';
    document.getElementById('saveKey').addEventListener('click', ()=>{
      localStorage.setItem(KEY_STORE, document.getElementById('apiKey').value.trim());
      alert(LANG==='ar'?'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ø­Ù„ÙŠÙ‹Ø§.':'Key saved locally.');
    });
    const savedKey = localStorage.getItem(KEY_STORE); if(savedKey) document.getElementById('apiKey').value = savedKey;

    /* -------------- Planner (AI or local) -------------- */
    function getPlannerOptions(){
      const equipment = Array.from(document.getElementById('equipment').selectedOptions).map(o=>o.value);
      return {
        goal: document.getElementById('goal').value,
        days: parseInt(document.getElementById('days').value,10),
        level: document.getElementById('level').value,
        focusArea: document.getElementById('focusArea').value.trim(),
        equipment: equipment.length? equipment : ['gym'],
        lang: LANG
      };
    }
    function buildPrompt(opts){
      const label = (LANG==='ar'
        ? `Ø£Ù†Øª Ù…Ø¯Ø±Ù‘Ø¨ Ù…Ø­ØªØ±Ù. Ø£Ù†Ø´Ø¦ Ø®Ø·Ø© ØªØ¯Ø±ÙŠØ¨ Ù„Ù…Ø¯Ø© ${opts.days} Ø£ÙŠØ§Ù…/Ø£Ø³Ø¨ÙˆØ¹ Ù„Ù‡Ø¯Ù "${opts.goal}" ÙˆÙ…Ø³ØªÙˆÙ‰ "${opts.level}"` + (opts.focusArea? ` Ù…Ø¹ ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰: ${opts.focusArea}.`:'') + ` Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©: ${opts.equipment.join(', ')}. Ø£Ø¹Ø· Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©ØŒ Ù…Ø¬Ù…ÙˆØ¹Ø§ØªÃ—ØªÙƒØ±Ø§Ø±Ø§ØªØŒ ØªÙ…Ø¨Ùˆ ÙˆØ±Ø§Ø­Ø©ØŒ ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ‚Ù†ÙŠØ© Ù‚ØµÙŠØ±Ø©.`
        : `You are a pro coach. Create a ${opts.days}-day/week plan for goal "${opts.goal}" and level "${opts.level}"` + (opts.focusArea? ` with focus on: ${opts.focusArea}.`:'') + ` Available equipment: ${opts.equipment.join(', ')}. Return exercise names in Arabic & English, setsÃ—reps, tempo, rest, and brief technique notes.`
      );
      return label + (LANG==='ar' ? `\nØµÙŠØºØ© Ù…Ù†Ø¸Ù…Ø©:\nØ§Ù„ÙŠÙˆÙ… 1 â€” Ø§Ù„Ø¹Ù†ÙˆØ§Ù†\nâ€¢ ØªÙ…Ø±ÙŠÙ† â€” 4Ã—8â€“12 | ØªÙ…Ø¨Ùˆ: 2-1-2 | Ø±Ø§Ø­Ø©: 90s\nâ€¦` : `\nFormat:\nDay 1 â€” Title\nâ€¢ Exercise â€” 4Ã—8â€“12 | Tempo: 2-1-2 | Rest: 90s\nâ€¦`);
    }
    function repRange(goal, type){
      if(goal==='strength') return (type==='isolation')?'3Ã—6â€“8':'5Ã—3â€“5';
      if(goal==='endurance') return '3Ã—15â€“20';
      if(goal==='fatloss') return '3â€“4Ã—10â€“15';
      if(goal==='focus') return (type==='isolation')?'3Ã—12â€“15':'4Ã—8â€“12';
      return (type==='isolation')?'3Ã—12â€“15':'4Ã—8â€“12';
    }
    function findGroupIdFromText(text){
      const t=text.toLowerCase();
      if(/ØµØ¯Ø±|chest/.test(t)) return 'chest';
      if(/Ø¸Ù‡Ø±|back/.test(t)) return 'back';
      if(/Ø³Ø§Ù‚|Ø±Ø¬Ù„|legs|quads|hamstring|calf/.test(t)) return 'legs';
      if(/ÙƒØªÙ|shoulder/.test(t)) return 'shoulders';
      if(/Ø°Ø±Ø§Ø¹|arm|bicep|tricep/.test(t)) return 'arms';
      if(/Ø¨Ø·Ù†|ÙƒÙˆØ±|Ø¬Ø°Ø¹|abs|core/.test(t)) return 'core';
      if(/Ø£Ø±Ø¯Ø§Ù|glute|Ù…Ù†Ø²Ù„/.test(t)) return 'bonus';
      return null;
    }
    function pickExercises(groupIds, count, equipSet, biasId){
      let pool = EX.filter(e=> groupIds.includes(e.groupId) && e.equip.some(t=>equipSet.has(t) || equipSet.has('gym')));
      if(biasId){ const biased = pool.filter(e=>e.groupId===biasId); pool = [...biased, ...pool]; }
      const best = pool.filter(e=>e.badges.includes('Ø§Ù„Ø£ÙØ¶Ù„'));
      const rest = pool.filter(e=>!e.badges.includes('Ø§Ù„Ø£ÙØ¶Ù„'));
      const chosen=[];
      function take(arr){ while(arr.length && chosen.length<count){ const i=Math.floor(Math.random()*arr.length); chosen.push(arr.splice(i,1)[0]); } }
      take(best); take(rest);
      return chosen.slice(0,count);
    }
    function dayTitle(id){ const d=id+1; return LANG==='ar' ? `Ø§Ù„ÙŠÙˆÙ… ${d}` : `Day ${d}`; }
    function buildLocalPlan(opts){
      const eq = new Set(opts.equipment);
      const bias = findGroupIdFromText(opts.focusArea||'');
      const blocks = [];
      let split;

      if(opts.days===3){ split = ['push','pull','legs']; }
      else if(opts.days===4){ split = ['upper','lower','upper','lower']; }
      else if(opts.days===5){ split = ['upper','lower','push','pull','full']; }
      else { split = ['push','pull','legs','push','pull','legs']; }

      split.forEach((type, i)=>{
        let groups, title;
        if(type==='push'){ groups=['chest','shoulders','arms']; title = LANG==='ar'?'Ø¯ÙØ¹ (ØµØ¯Ø±/ÙƒØªÙ/ØªØ±Ø§ÙŠ)':'Push (Chest/Shoulders/Triceps)'; }
        else if(type==='pull'){ groups=['back','shoulders','arms']; title = LANG==='ar'?'Ø³Ø­Ø¨ (Ø¸Ù‡Ø±/Ø¨Ø§ÙŠØ³Ø¨Ø³)':'Pull (Back/Biceps)'; }
        else if(type==='legs'){ groups=['legs','bonus','core']; title = LANG==='ar'?'Ø£Ø±Ø¬Ù„ ÙˆØ£Ø±Ø¯Ø§Ù':'Legs & Glutes'; }
        else if(type==='upper'){ groups=['chest','back','shoulders','arms']; title = LANG==='ar'?'Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¹Ù„ÙˆÙŠ':'Upper'; }
        else if(type==='lower'){ groups=['legs','bonus','core']; title = LANG==='ar'?'Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³ÙÙ„ÙŠ':'Lower'; }
        else { groups=['chest','back','legs','shoulders','arms','core']; title = LANG==='ar'?'ÙÙ„ Ø¨ÙˆØ¯ÙŠ':'Full Body'; }

        const main = pickExercises(groups, 5, eq, bias);
        const lines = [];
        lines.push((LANG==='ar'?`â€” ${title}`:`â€” ${title}`));
        main.forEach(exe=>{
          const r = repRange(opts.goal, exe.type);
          const tempo = exe.tempo;
          const rest = exe.rest;
          const name = `${exe.nameAr} | ${exe.nameEn}`;
          lines.push(`â€¢ ${name} â€” ${r} | ${LANG==='ar'?'ØªÙ…Ø¨Ùˆ':'Tempo'}: ${tempo} | ${LANG==='ar'?'Ø±Ø§Ø­Ø©':'Rest'}: ${rest}`);
        });
        if(!groups.includes('core')){
          const corePick = pickExercises(['core'], 1, eq, bias)[0];
          if(corePick){
            lines.push(`â€¢ ${LANG==='ar'?'Ù…Ù†Ù‡ÙŠÙ‘Ø© ÙƒÙˆØ±':'Core Finisher'}: ${corePick.nameAr} | ${corePick.nameEn} â€” ${repRange(opts.goal, corePick.type)}`);
          }
        }
        blocks.push(`${dayTitle(i)} ${lines.join('\n')}`);
      });

      const head = (LANG==='ar'
        ? `Ø®Ø·Ø© ØªØ¯Ø±ÙŠØ¨ (${opts.days} Ø£ÙŠØ§Ù…/Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹) â€” Ø§Ù„Ù‡Ø¯Ù: ${opts.goal}${opts.focusArea?` â€” ØªØ±ÙƒÙŠØ²: ${opts.focusArea}`:''}\nØ§Ù„Ù…Ø¹Ø¯Ø§Øª: ${opts.equipment.join('ØŒ ')}\n`
        : `Training Plan (${opts.days} days/week) â€” Goal: ${opts.goal}${opts.focusArea?` â€” Focus: ${opts.focusArea}`:''}\nEquipment: ${opts.equipment.join(', ')}\n`
      );
      const notes = (LANG==='ar'
        ? `\nÙ…Ù„Ø§Ø­Ø¸Ø§Øª:\nâ€¢ Ø§Ø¨Ø¯Ø£ Ø¥Ø­Ù…Ø§Ø¡ Ø¹Ø§Ù… 5â€“10 Ø¯Ù‚Ø§Ø¦Ù‚ + Ø¥Ø­Ù…Ø§Ø¡ Ø®Ø§Øµ Ù„Ù„ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø£ÙˆÙ„.\nâ€¢ Ø²ÙØ¯ Ø§Ù„Ø£Ø­Ù…Ø§Ù„ ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ù†ÙŠØ©.\nâ€¢ Ø³Ø¬Ù‘Ù„ Ø§Ù„ØªÙ‚Ø¯Ù‘Ù… Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§.`
        : `\nNotes:\nâ€¢ Begin with 5â€“10 min general warm-up + ramp-up sets.\nâ€¢ Progressive overload with clean form.\nâ€¢ Log progress weekly.`
      );
      return head + blocks.join('\n\n') + notes;
    }

    const planOut = document.getElementById('planOutput');

    document.getElementById('genLocal').addEventListener('click', ()=>{
      const opts = getPlannerOptions();
      planOut.textContent = LANG==='ar'?'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ù…Ø­Ù„ÙŠÙ‹Ø§â€¦':'Generating locallyâ€¦';
      setTimeout(()=>{ planOut.textContent = buildLocalPlan(opts); }, 50);
    });

    document.getElementById('genGemini').addEventListener('click', async ()=>{
      const opts = getPlannerOptions();
      const apiKey = (document.getElementById('apiKey').value||'').trim();
      const prompt = buildPrompt(opts);

      if(!window.AI || typeof window.AI.generatePlan!=='function'){
        planOut.textContent = (LANG==='ar'
          ? 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù ai.js. Ø£Ø¶Ù Ù…Ù„ÙÙ‹Ø§ Ø¨Ø§Ø³Ù… "ai.js" ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ù„ØªØ¹Ø±ÙŠÙ window.AI.generatePlan(). ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…Ø±ÙÙ‚ ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª.'
          : 'ai.js not found. Add a local "ai.js" next to this file that defines window.AI.generatePlan(). Use the template provided below.');
        return;
      }
      if(!apiKey){
        planOut.textContent = LANG==='ar'?'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ API (Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø­Ù„ÙŠ).':'Please enter an Gemini API key (or use local generation).';
        return;
      }
      planOut.textContent = LANG==='ar'?'ÙŠØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¹Ø¨Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠâ€¦':'Generating via AIâ€¦';
      try{
        const text = await window.AI.generatePlan({opts, prompt, apiKey});
        planOut.textContent = (text && typeof text==='string') ? text : (LANG==='ar'?'ØªØ¹Ø°Ø± ØªÙØ³ÙŠØ± Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.':'Could not parse AI response.');
      }catch(err){
        console.error(err);
        planOut.textContent = (LANG==='ar'?'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.':'AI request failed.') + ' ' + (err?.message||'');
      }
    });

    // Save / Load Plans
    const PLANS_KEY='plans_v1';
    function loadPlans(){ return JSON.parse(localStorage.getItem(PLANS_KEY)||'[]'); }
    function savePlans(lst){ localStorage.setItem(PLANS_KEY, JSON.stringify(lst)); }
    function renderPlans(){
      const wrap=document.getElementById('plansList'); wrap.innerHTML='';
      const lst=loadPlans().sort((a,b)=>b.created-a.created);
      if(!lst.length){ wrap.innerHTML = `<div class="meta">${LANG==='ar'?'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø· Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯.':'No saved plans yet.'}</div>`; return; }
      lst.forEach(p=>{
        const card=document.createElement('div'); card.className='card fadeIn';
        const content=document.createElement('div'); content.className='content';
        const title=document.createElement('div'); title.className='title';
        title.innerHTML=`<strong>${p.name}</strong>`;
        const meta=document.createElement('div'); meta.className='meta';
        meta.textContent = new Date(p.created).toLocaleString();
        const text=document.createElement('pre'); text.style.whiteSpace='pre-wrap'; text.textContent=p.text;
        const actions=document.createElement('div'); actions.className='actions';
        const copy=document.createElement('button'); copy.className='btn'; copy.innerHTML='<i class="fa-regular fa-copy"></i> Copy'; copy.onclick=()=>{ navigator.clipboard.writeText(p.text); };
        const del=document.createElement('button'); del.className='btn'; del.innerHTML='<i class="fa-regular fa-trash-can"></i> Delete'; del.onclick=()=>{ const all=loadPlans().filter(x=>x.id!==p.id); savePlans(all); renderPlans(); };
        actions.appendChild(copy); actions.appendChild(del);
        content.appendChild(title); content.appendChild(meta); content.appendChild(text); content.appendChild(actions);
        card.appendChild(content); wrap.appendChild(card);
      });
    }
    document.getElementById('savePlan').addEventListener('click', ()=>{
      const txt = planOut.textContent.trim();
      if(!txt){ alert(LANG==='ar'?'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø© Ù„Ø­ÙØ¸Ù‡Ø§.':'Nothing to save.'); return; }
      const opts = getPlannerOptions();
      const id = Date.now().toString(36);
      const name = (LANG==='ar'?'Ø®Ø·Ø© ':'Plan ') + `${opts.days}d-${opts.goal}`;
      const lst=loadPlans(); lst.push({id, name, text:txt, created:Date.now(), opts}); savePlans(lst); renderPlans();
      alert(LANG==='ar'?'ØªÙ… Ø§Ù„Ø­ÙØ¸.':'Saved.');
    });

    // PWA install
    let deferredPrompt=null;
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault(); deferredPrompt=e; document.getElementById('installBtn').style.display='inline-flex';
    });
    document.getElementById('installBtn').addEventListener('click', async ()=>{
      if(!deferredPrompt) return;
      deferredPrompt.prompt(); const {outcome}=await deferredPrompt.userChoice; deferredPrompt=null;
    });

    // Offline SW
    (function registerSW(){
      if(!('serviceWorker' in navigator)) return;
      const code = `
        const CACHE='stp-v1';
        self.addEventListener('install', e=>{ self.skipWaiting(); });
        self.addEventListener('activate', e=>{ e.waitUntil(self.clients.claim()); });
        self.addEventListener('message', e=>{ if(e.data&&e.data.type==='CACHE_URLS'){ caches.open(CACHE).then(c=>c.addAll(e.data.urls)); } });
        self.addEventListener('fetch', e=>{
          const req=e.request;
          if(req.method!=='GET') return;
          if(req.mode==='navigate'){
            e.respondWith(fetch(req).then(r=>{ const c=r.clone(); caches.open(CACHE).then(cc=>cc.put(req,c)); return r; }).catch(()=>caches.match(req)));
            return;
          }
          const url=new URL(req.url);
          if(url.origin===location.origin){
            e.respondWith(caches.match(req).then(hit=>hit||fetch(req).then(r=>{ const c=r.clone(); caches.open(CACHE).then(cc=>cc.put(req,c)); return r; }).catch(()=>hit)));
          }else{
            e.respondWith(fetch(req).catch(()=>caches.match(req)));
          }
        });
      `;
      const blob = new Blob([code], {type:'text/javascript'});
      navigator.serviceWorker.register(URL.createObjectURL(blob)).then(()=>{
        if(navigator.serviceWorker.controller){
          navigator.serviceWorker.controller.postMessage({type:'CACHE_URLS', urls:[location.href]});
        }else{
          navigator.serviceWorker.addEventListener('controllerchange', ()=>{
            if(navigator.serviceWorker.controller){
              navigator.serviceWorker.controller.postMessage({type:'CACHE_URLS', urls:[location.href]});
            }
          });
        }
      }).catch(console.warn);
    })();

    // Initial render
    applyTheme(); applyLang(); renderPlans();
  </script>

  <!-- Inline AI (Gemini): provides window.AI.generatePlan({opts, prompt, apiKey}) -->
  <script>
  (function(){
    function t(s){ return (document.documentElement.lang === 'ar') ? s.ar : s.en; }
    async function geminiCall(apiKey, systemText, userText, model){
      const url = `https://generativelanguage.googleapis.com/v1beta/models/${model || 'gemini-1.5-flash'}:generateContent`;
      const body = {
        systemInstruction: { role: "system", parts: [{ text: systemText }] },
        contents: [{ role: "user", parts: [{ text: userText }]}],
        generationConfig: { temperature: 0.7, maxOutputTokens: 1200 }
      };
      const r = await fetch(url + `?key=${encodeURIComponent(apiKey)}`, {
        method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(body)
      });
      if(!r.ok){
        const txt = await r.text().catch(()=>'');
        throw new Error(t({
          ar: "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Gemini. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ÙØªØ§Ø­ ÙˆØ§Ù„Ø·Ø±Ø§Ø². Ø§Ù„ØªÙØ§ØµÙŠÙ„: " + txt,
          en: "Failed calling Gemini. Check key/model. Details: " + txt
        }));
      }
      const j = await r.json();
      const parts = j?.candidates?.[0]?.content?.parts || [];
      const text = parts.map(p=>p.text||"").join("").trim();
      if(!text) throw new Error(t({ar:"Ù„Ù… Ø£ØªÙ„Ù‚Ù‘Ù Ù†ØµÙ‹Ø§ Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬.", en:"No content returned by model."}));
      return text;
    }

    window.AI = window.AI || {};
    window.AI.generatePlan = async function({opts, prompt, apiKey}){
      if(!apiKey || typeof apiKey!=='string'){
        throw new Error(t({ar:"Ù…Ø·Ù„ÙˆØ¨ Ù…ÙØªØ§Ø­ Gemini API.", en:"Gemini API key is required."}));
      }
      const sys = t({
        ar: "Ø£Ù†Øª Ù…Ø¯Ø±Ø¨ Ù„ÙŠØ§Ù‚Ø© ÙŠÙƒØªØ¨ Ø®Ø·Ø·Ù‹Ø§ ÙˆØ§Ø¶Ø­Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©ØŒ Ù…Ù†Ø¸Ù…Ø© Ø­Ø³Ø¨ Ø§Ù„Ø£ÙŠØ§Ù…ØŒ Ù…Ø¹ Ù…Ø¬Ù…ÙˆØ¹Ø§ØªÃ—ØªÙƒØ±Ø§Ø±Ø§ØªØŒ ØªÙ…Ø¨ÙˆØŒ Ø±Ø§Ø­Ø©ØŒ ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ‚Ù†ÙŠØ© Ù‚ØµÙŠØ±Ø©. Ø§Ø³ØªØ®Ø¯Ù… Ù†Ù‚Ø§Ø·Ù‹Ø§ Ù…Ø±ØªØ¨Ø© ÙˆØ³Ù‡Ù„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.",
        en: "You are a fitness coach producing clear, day-structured plans with setsÃ—reps, tempo, rest, and brief technique notes, bilingual (Arabic & English). Use tidy bullet lists."
      });
      return await geminiCall(apiKey, sys, prompt, "gemini-1.5-flash");
    };
  })();
  </script>
</body>
</html>
